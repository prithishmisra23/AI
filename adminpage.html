<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | PM Internship Portal</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; background: #f4f7fa; }
    .sidebar {
      width: 250px; height: 100vh; background: #2f3b52; color: #fff;
      padding-top: 20px; position: fixed; top: 0; left: 0;
    }
    .sidebar h2 { text-align: center; margin-bottom: 30px; font-size: 20px; color: #fff; }
    .sidebar a { display: block; padding: 15px 20px; color: #fff; text-decoration: none;
      margin-bottom: 10px; border-left: 4px solid transparent; transition: all 0.3s; }
    .sidebar a:hover, .sidebar a.active { background: #1e2a3c; border-left: 4px solid #ff7f50; }

    .main { margin-left: 250px; padding: 20px; width: calc(100% - 250px); }
    .content { background: #fff; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h2 { color: #2c3e50; margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #3498db; color: white; }
    tr:hover { background: #f9f9f9; }
    .btn { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 2px; }
    .btn-edit { background: #f39c12; color: white; }
    .btn-delete { background: #e74c3c; color: white; }
    .btn-save { background: #27ae60; color: white; }
    .form-group { margin-bottom: 15px; }
    label { font-weight: bold; display: block; margin-bottom: 6px; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
    <a href="adminpage.html" class="active"><i class="fas fa-home"></i> Dashboard</a>
    <a href="#students"><i class="fas fa-users"></i> Students</a>
    <a href="#companies"><i class="fas fa-building"></i> Companies</a>
    <a href="#applications"><i class="fas fa-file-alt"></i> Applications</a>
    <a href="#settings"><i class="fas fa-cog"></i> Settings</a>
    <a href="logout.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <!-- Main Content -->
  <div class="main">

    <!-- Students -->
    <div class="content" id="students">
      <h2><i class="fas fa-users"></i> Students</h2>
      <table id="studentsTable">
        <thead>
          <tr><th>Name</th><th>Email</th><th>Phone</th><th>Skills</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Companies -->
    <div class="content" id="companies">
      <h2><i class="fas fa-building"></i> Companies</h2>
      <table id="companiesTable">
        <thead>
          <tr><th>Company</th><th>Email</th><th>Posted Jobs</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Applications -->
    <div class="content" id="applications">
      <h2><i class="fas fa-file-alt"></i> Applications</h2>
      <table id="applicationsTable">
        <thead>
          <tr><th>Student</th><th>Company</th><th>Job</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Settings -->
    <div class="content" id="settings">
      <h2><i class="fas fa-cog"></i> Settings</h2>

      <!-- Change Password -->
      <div class="form-group">
        <label>Change Admin Password</label>
        <input type="password" id="newPassword" placeholder="Enter new password">
        <button class="btn btn-save" onclick="changePassword()">Update Password</button>
      </div>

      <!-- Manage Roles -->
      <div class="form-group">
        <label>Assign Role to User</label>
        <input type="email" id="roleEmail" placeholder="Enter user email">
        <select id="roleSelect">
          <option value="student">Student</option>
          <option value="recruiter">Recruiter</option>
          <option value="admin">Admin</option>
        </select>
        <button class="btn btn-save" onclick="assignRole()">Save Role</button>
      </div>

      <!-- Portal Config -->
      <div class="form-group">
        <label>Default Internship Duration (months)</label>
        <input type="number" id="defaultDuration" value="3">
        <button class="btn btn-save" onclick="updateConfig()">Save Config</button>
      </div>

      <!-- Theme -->
      <div class="form-group">
        <label>Theme</label>
        <select id="themeSelect" onchange="toggleTheme()">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
    </div>

  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.27.0/dist/umd/supabase.min.js"></script>
  <script>
    const SUPABASE_URL = "YOUR_SUPABASE_URL";
    const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const studentsTable = document.querySelector("#studentsTable tbody");
    const companiesTable = document.querySelector("#companiesTable tbody");
    const applicationsTable = document.querySelector("#applicationsTable tbody");

    // === Load Data ===
    async function loadStudents() {
      const { data, error } = await supabase.from("students").select("*");
      if (error) return console.error(error);
      studentsTable.innerHTML = "";
      data.forEach(s => {
        studentsTable.innerHTML += `
          <tr>
            <td>${s.full_name}</td>
            <td>${s.email}</td>
            <td>${s.phone || "-"}</td>
            <td>${s.skills || "-"}</td>
            <td>
              <button class="btn btn-edit">Edit</button>
              <button class="btn btn-delete">Delete</button>
            </td>
          </tr>`;
      });
    }
    async function loadCompanies() {
      const { data, error } = await supabase.from("recruiters").select("*");
      if (error) return console.error(error);
      companiesTable.innerHTML = "";
      data.forEach(c => {
        companiesTable.innerHTML += `
          <tr>
            <td>${c.company_name}</td>
            <td>${c.email}</td>
            <td>${c.posted_jobs || 0}</td>
            <td>
              <button class="btn btn-edit">Edit</button>
              <button class="btn btn-delete">Delete</button>
            </td>
          </tr>`;
      });
    }
    async function loadApplications() {
      const { data, error } = await supabase
        .from("applications")
        .select("id, status, student_name, internships(job_title, company_name)");
      if (error) return console.error(error);
      applicationsTable.innerHTML = "";
      data.forEach(a => {
        applicationsTable.innerHTML += `
          <tr>
            <td>${a.student_name}</td>
            <td>${a.internships?.company_name || "-"}</td>
            <td>${a.internships?.job_title || "-"}</td>
            <td>${a.status}</td>
            <td>
              <button class="btn btn-edit">Edit</button>
              <button class="btn btn-delete">Delete</button>
            </td>
          </tr>`;
      });
    }

    // === Settings Functions ===
    async function changePassword() {
      const newPassword = document.getElementById("newPassword").value;
      if (!newPassword) return alert("Enter new password!");
      alert("Password update logic will be handled with Supabase Auth API");
    }
    async function assignRole() {
      const email = document.getElementById("roleEmail").value;
      const role = document.getElementById("roleSelect").value;
      if (!email) return alert("Enter email!");
      alert(`Role ${role} assigned to ${email} (to be stored in roles table)`);
    }
    async function updateConfig() {
      const duration = document.getElementById("defaultDuration").value;
      alert(`Default duration updated to ${duration} months (save in config table)`);
    }
    function toggleTheme() {
      const theme = document.getElementById("themeSelect").value;
      if (theme === "dark") {
        document.body.style.background = "#2c3e50";
        document.querySelectorAll(".content").forEach(el => el.style.background = "#34495e");
      } else {
        document.body.style.background = "#f4f7fa";
        document.querySelectorAll(".content").forEach(el => el.style.background = "#fff");
      }
    }

    // === Init ===
    loadStudents();
    loadCompanies();
    loadApplications();
  </script>
</body>
</html>
