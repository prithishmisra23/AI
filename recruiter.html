<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recruiter Dashboard | PM Internship Portal</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      background: #f5f7fa; 
      color: #333;
    }
    .sidebar { 
      width: 250px; 
      height: 100vh; 
      background: #2c3e50; 
      position: fixed; 
      top: 0; 
      left: 0; 
      color: #fff; 
      padding-top: 20px; 
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    .sidebar h2 { 
      text-align: center; 
      margin-bottom: 30px;
      color: #ecf0f1;
      font-weight: 600;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar a { 
      display: flex; 
      align-items: center;
      padding: 15px 20px; 
      color: #bdc3c7; 
      text-decoration: none; 
      margin-bottom: 5px; 
      border-left: 4px solid transparent;
      transition: all 0.3s;
    }
    .sidebar a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    .sidebar a:hover { 
      background: #34495e; 
      color: #fff;
      border-left: 4px solid #3498db;
    }
    .main { 
      margin-left: 250px; 
      padding: 25px; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e6ed;
    }
    .header h1 { 
      margin: 0; 
      font-size: 28px; 
      color: #2c3e50;
      font-weight: 600;
    }
    .card-container { 
      display: flex; 
      gap: 20px; 
      margin-bottom: 25px; 
      flex-wrap: wrap; 
    }
    .card { 
      flex: 1 1 200px; 
      background: #fff; 
      padding: 20px; 
      border-radius: 10px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
      text-align: center;
      transition: transform 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card h3 {
      margin-top: 0;
      color: #7f8c8d;
      font-size: 16px;
      font-weight: 500;
    }
    .card p {
      font-size: 28px;
      font-weight: 700;
      color: #2c3e50;
      margin: 10px 0 0;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      background: #fff; 
      border-radius: 10px; 
      overflow: hidden; 
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    table th, table td { 
      padding: 14px 16px; 
      text-align: left; 
      border-bottom: 1px solid #e0e6ed; 
    }
    table th { 
      background: #f8f9fa; 
      position: sticky;
      top: 0;
      font-weight: 600;
      color: #2c3e50;
    }
    table tr:hover {
      background-color: #f5f9ff;
    }
    .btn { 
      padding: 10px 18px; 
      border: none; 
      background: #3498db; 
      color: #fff; 
      border-radius: 6px; 
      cursor: pointer; 
      font-weight: 500;
      transition: background 0.3s;
    }
    .btn:hover { 
      background: #2980b9; 
    }
    .btn-danger {
      background: #e74c3c;
    }
    .btn-danger:hover {
      background: #c0392b;
    }
    .form-container { 
      background: #fff; 
      padding: 25px; 
      border-radius: 10px; 
      margin-bottom: 25px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
    }
    .form-container h2 {
      margin-top: 0;
      color: #2c3e50;
    }
    .form-container input, .form-container textarea, .form-container select { 
      width: 100%; 
      padding: 12px; 
      margin-bottom: 15px; 
      border: 1px solid #dce1e6; 
      border-radius: 6px; 
      box-sizing: border-box;
      font-family: inherit;
    }
    .form-container input:focus, .form-container textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #e0e6ed;
    }
    .tab {
      padding: 12px 24px;
      cursor: pointer;
      background: #f8f9fa;
      border-radius: 6px 6px 0 0;
      margin-right: 5px;
      font-weight: 500;
      color: #7f8c8d;
      transition: all 0.3s;
    }
    .tab.active {
      background: #3498db;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .data-table-container {
      max-height: 600px;
      overflow: auto;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .loading {
      text-align: center;
      padding: 30px;
      color: #7f8c8d;
    }
    .loading i {
      font-size: 24px;
      margin-bottom: 10px;
      display: block;
      color: #3498db;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .filter-container {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }
    .filter-container input, .filter-container select {
      padding: 10px;
      border: 1px solid #dce1e6;
      border-radius: 6px;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2><i class="fas fa-graduation-cap"></i> PM Internship</h2>
    <a href="recruiter.html" class="active"><i class="fas fa-home"></i> Dashboard</a>
    <a href="PostInternships.html"><i class="fas fa-briefcase"></i> Post Internships</a>
    <a href="RecruiterApplications.html"><i class="fas fa-file-alt"></i> Applications</a>
    <a href="RecruiterSettings.html"><i class="fas fa-cog"></i> Settings</a>
    <a href="logout.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="header">
      <h1><i class="fas fa-tachometer-alt"></i> Recruiter Dashboard</h1>
      <div>
        <span id="last-updated">Last updated: Just now</span>
      </div>
    </div>

    <!-- Stats -->
    <div class="card-container">
      <div class="card">
        <h3><i class="fas fa-users"></i> Total Candidates</h3>
        <p id="total-candidates">0</p>
      </div>
      <div class="card">
        <h3><i class="fas fa-building"></i> Total Companies</h3>
        <p id="total-companies">0</p>
      </div>
      <div class="card">
        <h3><i class="fas fa-graduation-cap"></i> Top Education</h3>
        <p id="top-education">N/A</p>
      </div>
      <div class="card">
        <h3><i class="fas fa-code"></i> Top Skill</h3>
        <p id="top-skill">N/A</p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('candidates')"><i class="fas fa-user-graduate"></i> Candidate Data</div>
      <div class="tab" onclick="switchTab('companies')"><i class="fas fa-building"></i> Company Data</div>
      <div class="tab" onclick="switchTab('post')"><i class="fas fa-plus-circle"></i> Post New Internship</div>
    </div>

    <!-- Candidate Data Tab -->
    <div id="candidates-tab" class="tab-content active">
      <h2><i class="fas fa-user-graduate"></i> Candidate Database</h2>
      
      <div class="filter-container">
        <input type="text" id="candidate-search" placeholder="Search candidates..." onkeyup="filterCandidates()">
        <select id="education-filter" onchange="filterCandidates()">
          <option value="">All Education Levels</option>
          <option value="10">Class 10</option>
          <option value="12">Class 12</option>
          <option value="Graduation">Graduation</option>
        </select>
        <select id="skill-filter" onchange="filterCandidates()">
          <option value="">All Skills</option>
        </select>
      </div>
      
      <div class="data-table-container">
        <table id="candidates-table">
          <thead>
            <tr>
              <th>Full Name</th>
              <th>Age</th>
              <th>Gender</th>
              <th>Email</th>
              <th>Phone</th>
              <th>State</th>
              <th>Class 10 %</th>
              <th>Class 12 %</th>
              <th>Grad %</th>
              <th>Degree</th>
              <th>Skills</th>
              <th>Experience</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="12" class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <div>Loading candidate data...</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Company Data Tab -->
    <div id="companies-tab" class="tab-content">
      <h2><i class="fas fa-building"></i> Company Database</h2>
      
      <div class="filter-container">
        <input type="text" id="company-search" placeholder="Search companies..." onkeyup="filterCompanies()">
        <select id="location-filter" onchange="filterCompanies()">
          <option value="">All Locations</option>
        </select>
      </div>
      
      <div class="data-table-container">
        <table id="companies-table">
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Company Location</th>
              <th>Class 10 % Required</th>
              <th>Class 12 % Required</th>
              <th>Graduation % Required</th>
              <th>Degree Required</th>
              <th>Skills Required</th>
              <th>Experience Required</th>
              <th>Internship Stipend</th>
              <th>Internship Duration</th>
              <th>Department</th>
              <th>Application Deadline</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="12" class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <div>Loading company data...</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Post Internship Tab -->
    <div id="post-tab" class="tab-content">
      <div class="form-container">
        <h2><i class="fas fa-plus-circle"></i> Post New Internship</h2>
        <input type="text" id="company_name" placeholder="Company Name" />
        <input type="text" id="title" placeholder="Internship Title" />
        <textarea id="description" placeholder="Description" rows="4"></textarea>
        <input type="text" id="skills" placeholder="Skills Required (comma separated)" />
        <input type="number" id="openings" placeholder="Number of Openings" />
        <input type="text" id="stipend" placeholder="Stipend" />
        <input type="text" id="duration" placeholder="Duration (e.g., 3 months)" />
        <input type="text" id="location" placeholder="Location" />
        <button class="btn" onclick="postInternship()">Post Internship</button>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.27.0/dist/umd/supabase.min.js"></script>
  <script>
    // ✅ Replace with your credentials
    const SUPABASE_URL = "https://xozzpzasbdvgpyysuvew.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvenpwemFzYmR2Z3B5eXN1dmV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3MDA0NjMsImV4cCI6MjA3MzI3NjQ2M30.SiiaH38cNz21EHpvGOZNQCQ5vW2f6H2GBocGn4qYfGM";
    
    // Initialize Supabase
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // Store data for filtering
    let allCandidates = [];
    let allCompanies = [];
    
    // Tab switching function
    function switchTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tab buttons
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Activate selected tab
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Activate the clicked tab button
      event.currentTarget.classList.add('active');
    }

    // Format phone number
    function formatPhoneNumber(phone) {
      if (!phone) return 'N/A';
      const phoneStr = phone.toString();
      if (phoneStr.length === 10) {
        return `${phoneStr.substring(0, 5)} ${phoneStr.substring(5)}`;
      }
      return phoneStr;
    }

    // Load dashboard data
    async function loadDashboard() {
      try {
        // Load candidate data from Aintern table
        let { data: candidates, error: candidateError } = await supabase
          .from("Aintern")
          .select("*");

        if (candidateError) {
          console.error("Error fetching candidates:", candidateError);
          document.querySelector("#candidates-table tbody").innerHTML = `
            <tr>
              <td colspan="12" class="error">
                <i class="fas fa-exclamation-circle"></i>
                Error loading candidate data: ${candidateError.message}
              </td>
            </tr>
          `;
        } else {
          // Store for filtering
          allCandidates = candidates || [];
          
          // Update candidate count
          document.getElementById("total-candidates").innerText = allCandidates.length;
          
          // Update top education
          const educationLevels = {};
          allCandidates.forEach(candidate => {
            const gradPercent = candidate["Grad %"];
            if (gradPercent > 85) educationLevels["Graduation"] = (educationLevels["Graduation"] || 0) + 1;
            
            const class12Percent = candidate["Class 12 %"];
            if (class12Percent > 85) educationLevels["Class 12"] = (educationLevels["Class 12"] || 0) + 1;
            
            const class10Percent = candidate["Class 10 %"];
            if (class10Percent > 85) educationLevels["Class 10"] = (educationLevels["Class 10"] || 0) + 1;
          });
          
          let topEducation = "N/A";
          if (Object.keys(educationLevels).length > 0) {
            topEducation = Object.keys(educationLevels).reduce((a, b) => 
              educationLevels[a] > educationLevels[b] ? a : b
            );
          }
          document.getElementById("top-education").innerText = topEducation;
          
          // Update top skill
          const skillsCount = {};
          allCandidates.forEach(candidate => {
            if (candidate.Skills) {
              const skills = candidate.Skills.split(',').map(skill => skill.trim());
              skills.forEach(skill => {
                if (skill) skillsCount[skill] = (skillsCount[skill] || 0) + 1;
              });
            }
          });
          
          let topSkill = "N/A";
          if (Object.keys(skillsCount).length > 0) {
            topSkill = Object.keys(skillsCount).reduce((a, b) => 
              skillsCount[a] > skillsCount[b] ? a : b
            );
          }
          document.getElementById("top-skill").innerText = topSkill;
          
          // Populate skills filter
          const skillFilter = document.getElementById("skill-filter");
          const uniqueSkills = [...new Set(Object.keys(skillsCount))];
          uniqueSkills.sort().forEach(skill => {
            if (skill) {
              const option = document.createElement("option");
              option.value = skill;
              option.textContent = skill;
              skillFilter.appendChild(option);
            }
          });
          
          // Display candidate data
          displayCandidates(allCandidates);
        }

        // Load company data from companies data table
        let { data: companies, error: companyError } = await supabase
          .from("companies data")
          .select("*");

        if (companyError) {
          console.error("Error fetching companies:", companyError);
          document.querySelector("#companies-table tbody").innerHTML = `
            <tr>
              <td colspan="12" class="error">
                <i class="fas fa-exclamation-circle"></i>
                Error loading company data: ${companyError.message}
              </td>
            </tr>
          `;
        } else {
          // Store for filtering
          allCompanies = companies || [];
          
          // Update company count
          document.getElementById("total-companies").innerText = allCompanies.length;
          
          // Populate location filter
          const locationFilter = document.getElementById("location-filter");
          const uniqueLocations = [...new Set(allCompanies.map(company => company["Company Location"]))];
          uniqueLocations.sort().forEach(location => {
            if (location) {
              const option = document.createElement("option");
              option.value = location;
              option.textContent = location;
              locationFilter.appendChild(option);
            }
          });
          
          // Display company data
          displayCompanies(allCompanies);
        }
        
        // Update last updated time
        document.getElementById("last-updated").textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
      } catch (error) {
        console.error("Unexpected error:", error);
      }
    }
    
    // Display candidates in the table
    function displayCandidates(candidates) {
      const candidateTable = document.querySelector("#candidates-table tbody");
      
      if (candidates.length === 0) {
        candidateTable.innerHTML = `
          <tr>
            <td colspan="12" style="text-align: center; padding: 30px; color: #7f8c8d;">
              <i class="fas fa-user-times" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
              No candidate data available
            </td>
          </tr>
        `;
        return;
      }
      
      candidateTable.innerHTML = "";
      
      candidates.forEach(candidate => {
        candidateTable.innerHTML += `
          <tr>
            <td>${candidate["Full Name"] || "N/A"}</td>
            <td>${candidate.Age || "N/A"}</td>
            <td>${candidate.Gender || "N/A"}</td>
            <td>${candidate.Email ? `<a href="mailto:${candidate.Email}">${candidate.Email}</a>` : "N/A"}</td>
            <td>${candidate.Phone ? formatPhoneNumber(candidate.Phone) : "N/A"}</td>
            <td>${candidate.State || "N/A"}</td>
            <td>${candidate["Class 10 %"] || "N/A"}</td>
            <td>${candidate["Class 12 %"] || "N/A"}</td>
            <td>${candidate["Grad %"] || "N/A"}</td>
            <td>${candidate.Degree || "N/A"}</td>
            <td>${candidate.Skills || "N/A"}</td>
            <td>${candidate["Experiences (Yes)"] ? `${candidate["Experiences (Yes)"]} years` : "N/A"}</td>
          </tr>
        `;
      });
    }
    
    // Display companies in the table
    function displayCompanies(companies) {
      const companyTable = document.querySelector("#companies-table tbody");
      
      if (companies.length === 0) {
        companyTable.innerHTML = `
          <tr>
            <td colspan="12" style="text-align: center; padding: 30px; color: #7f8c8d;">
              <i class="fas fa-building" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
              No company data available
            </td>
          </tr>
        `;
        return;
      }
      
      companyTable.innerHTML = "";
      
      companies.forEach(company => {
        companyTable.innerHTML += `
          <tr>
            <td>${company["Company Name"] || "N/A"}</td>
            <td>${company["Company Location"] || "N/A"}</td>
            <td>${company["Class 10 Percentage"] || "N/A"}</td>
            <td>${company["Class 12 Percentage"] || "N/A"}</td>
            <td>${company["Graduation Percentage"] || "N/A"}</td>
            <td>${company.Degree || "N/A"}</td>
            <td>${company.Skills || "N/A"}</td>
            <td>${company["Past Experience (months)"] ? `${company["Past Experience (months)"]} months` : "N/A"}</td>
            <td>${company["Internship Stipend (£/month)"] ? `£${company["Internship Stipend (£/month)"]}` : "N/A"}</td>
            <td>${company["Internship Duration (months)"] ? `${company["Internship Duration (months)"]} months` : "N/A"}</td>
            <td>${company.Department || "N/A"}</td>
            <td>${company["Application Deadline"] || "N/A"}</td>
          </tr>
        `;
      });
    }
    
    // Filter candidates based on search and filters
    function filterCandidates() {
      const searchText = document.getElementById("candidate-search").value.toLowerCase();
      const educationFilter = document.getElementById("education-filter").value;
      const skillFilter = document.getElementById("skill-filter").value;
      
      let filteredCandidates = allCandidates;
      
      // Apply search filter
      if (searchText) {
        filteredCandidates = filteredCandidates.filter(candidate => 
          (candidate["Full Name"] && candidate["Full Name"].toLowerCase().includes(searchText)) ||
          (candidate.Email && candidate.Email.toLowerCase().includes(searchText)) ||
          (candidate.Skills && candidate.Skills.toLowerCase().includes(searchText)) ||
          (candidate.Degree && candidate.Degree.toLowerCase().includes(searchText)) ||
          (candidate.State && candidate.State.toLowerCase().includes(searchText))
        );
      }
      
      // Apply education filter
      if (educationFilter) {
        if (educationFilter === "10") {
          filteredCandidates = filteredCandidates.filter(candidate => 
            candidate["Class 10 %"] && candidate["Class 10 %"] > 0
          );
        } else if (educationFilter === "12") {
          filteredCandidates = filteredCandidates.filter(candidate => 
            candidate["Class 12 %"] && candidate["Class 12 %"] > 0
          );
        } else if (educationFilter === "Graduation") {
          filteredCandidates = filteredCandidates.filter(candidate => 
            candidate["Grad %"] && candidate["Grad %"] > 0
          );
        }
      }
      
      // Apply skill filter
      if (skillFilter) {
        filteredCandidates = filteredCandidates.filter(candidate => 
          candidate.Skills && candidate.Skills.toLowerCase().includes(skillFilter.toLowerCase())
        );
      }
      
      // Display filtered candidates
      displayCandidates(filteredCandidates);
    }
    
    // Filter companies based on search and filters
    function filterCompanies() {
      const searchText = document.getElementById("company-search").value.toLowerCase();
      const locationFilter = document.getElementById("location-filter").value;
      
      let filteredCompanies = allCompanies;
      
      // Apply search filter
      if (searchText) {
        filteredCompanies = filteredCompanies.filter(company => 
          (company["Company Name"] && company["Company Name"].toLowerCase().includes(searchText)) ||
          (company.Department && company.Department.toLowerCase().includes(searchText)) ||
          (company.Skills && company.Skills.toLowerCase().includes(searchText)) ||
          (company.Degree && company.Degree.toLowerCase().includes(searchText))
        );
      }
      
      // Apply location filter
      if (locationFilter) {
        filteredCompanies = filteredCompanies.filter(company => 
          company["Company Location"] && company["Company Location"] === locationFilter
        );
      }
      
      // Display filtered companies
      displayCompanies(filteredCompanies);
    }

    // Post new internship
    async function postInternship() {
      alert("Internship posting functionality would be implemented here based on your database structure.");
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadDashboard();
      
      // Refresh data every 60 seconds
      setInterval(loadDashboard, 60000);
    });
  </script>
</body>
</html>
